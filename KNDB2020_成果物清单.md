# KNDB2020 æˆæœç‰©æ¸…å•

**æ¨¡å—ç¼–å·**: KNDB2020
**æ¨¡å—åç§°**: å¹´åº¦æœˆæ”¶å…¥æŠ¥å‘Šæ•°æ®ç›‘è§†
**å¼€å‘æ—¥æœŸ**: 2025-12-16
**å¼€å‘æ—¶é—´**: çº¦4å°æ—¶

---

## ğŸ“¦ æˆæœç‰©åˆ—è¡¨

### 1. Javaæºä»£ç æ–‡ä»¶ï¼ˆ9ä¸ªï¼‰

#### Entityç±»ï¼ˆ4ä¸ªï¼‰
```
src/main/java/com/liu/knbatch/entity/
â”œâ”€â”€ KNDB2020MonthSummaryEntity.java      (æœˆåº¦æ±‡æ€»éªŒè¯å®ä½“)
â”œâ”€â”€ KNDB2020ValidationSummaryEntity.java (æ±‡æ€»éªŒè¯ç»“æœå®ä½“)
â”œâ”€â”€ KNDB2020FeeErrorEntity.java          (è´¹ç”¨è¡¨é”™è¯¯è®°å½•å®ä½“)
â””â”€â”€ KNDB2020PayErrorEntity.java          (æ”¯ä»˜è¡¨é”™è¯¯è®°å½•å®ä½“)
```

#### DAOæ¥å£ï¼ˆ1ä¸ªï¼‰
```
src/main/java/com/liu/knbatch/dao/
â””â”€â”€ KNDB2020Dao.java                     (æ•°æ®è®¿é—®æ¥å£)
```

#### ä¸šåŠ¡é€»è¾‘ï¼ˆ1ä¸ªï¼‰
```
src/main/java/com/liu/knbatch/tasklet/
â””â”€â”€ KNDB2020Tasklet.java                 (ä¸šåŠ¡å¤„ç†ä»»åŠ¡)
```

#### é…ç½®ç±»ï¼ˆ1ä¸ªï¼‰
```
src/main/java/com/liu/knbatch/config/
â””â”€â”€ KNDB2020Config.java                  (Spring Batché…ç½®)
```

### 2. é…ç½®æ–‡ä»¶ï¼ˆ1ä¸ªï¼‰

```
src/main/resources/mybatis/mapper/
â””â”€â”€ KNDB2020Mapper.xml                   (MyBatis SQLæ˜ å°„)
```

### 3. æ•°æ®åº“è„šæœ¬ï¼ˆ3ä¸ªï¼‰

```
database/
â””â”€â”€ KNDB2020_insert_NOW.sql            (å®é™…é‚®ç®±ç‰ˆ - ç«‹å³å¯ç”¨)
```

### 4. æ–‡æ¡£èµ„æ–™ï¼ˆ3ä¸ªï¼‰

```
./
â”œâ”€â”€ KNDB2020_éƒ¨ç½²è¯´æ˜.md                 (å®Œæ•´éƒ¨ç½²æŒ‡å—)
â”œâ”€â”€ KNDB2020_æµ‹è¯•æ¸…å•.md                 (æµ‹è¯•æ£€æŸ¥æ¸…å•)
â”œâ”€â”€ KNDB2020_æˆæœç‰©æ¸…å•.md               (æœ¬æ–‡æ¡£)
â””â”€â”€ å¼€å‘æ‰‹é¡º_æ–°Batchæ¨¡å—æ ‡å‡†æµç¨‹.md      (æ ‡å‡†å¼€å‘æµç¨‹)
```

---

## ğŸ”§ æ•°æ®åº“åˆæœŸåŒ–å‘½ä»¤

### æ‰§è¡ŒSQLé…ç½®

```bash
# è¿æ¥æ•°æ®åº“å¹¶æ‰§è¡Œé…ç½®è„šæœ¬(å¼€å‘æ•°æ®åº“æˆ–æ˜¯æµ‹è¯•æ•°æ®åº“)
mysql -h 192.168.50.101 -P 49168 -u root -p7654321 KNStudent < database/KNDB2020_insert_NOW.sql

# è¿æ¥æ•°æ®åº“å¹¶æ‰§è¡Œé…ç½®è„šæœ¬(æ­£å¼æ•°æ®åº“)
mysql -h 192.168.50.101 -P 49168 -u root -p7654321 prod_KNStudent < database/KNDB2020_insert_NOW.sql
```

### éªŒè¯é…ç½®

```sql
-- æŸ¥çœ‹ä½œä¸šé…ç½®
SELECT job_id, bean_name, description, batch_enabled
FROM t_batch_job_config
WHERE job_id = 'KNDB2020';

-- æŸ¥çœ‹é‚®ä»¶é…ç½®
SELECT job_id, email_from, mail_to_devloper
FROM t_batch_mail_config
WHERE job_id = 'KNDB2020';
```

---

## ğŸš€ æµ‹è¯•æ‰§è¡Œå‘½ä»¤

### 1. è®¾ç½®ç¯å¢ƒå˜é‡

```bash
source setup-env-test_or_dev.sh
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
mvn clean package -DskipTests
```

### 3. æ‰§è¡Œæµ‹è¯•

#### MANUALæ¨¡å¼ï¼ˆæŒ‡å®šæ—¥æœŸï¼‰
```bash
# ä½¿ç”¨Maven
mvn spring-boot:run -Dspring-boot.run.arguments="--job.name=KNDB2020_MANUAL --base.date=20251216"

# ä½¿ç”¨JARåŒ…
java -jar target/knbatch-1.0.0.jar --job.name=KNDB2020_MANUAL --base.date=20251216
```

#### AUTOæ¨¡å¼ï¼ˆå½“å‰æ—¥æœŸï¼‰
```bash
# ä½¿ç”¨Maven
mvn spring-boot:run -Dspring-boot.run.arguments="--job.name=KNDB2020_AUTO"

# ä½¿ç”¨JARåŒ…
java -jar target/knbatch-1.0.0.jar --job.name=KNDB2020_AUTO
```

### 4. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—
tail -100 logs/knpiano-batch.log | grep KNDB2020

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -100 logs/knpiano-batch-error.log | grep KNDB2020
```

---

## ğŸ“Š å…³é”®é…ç½®ä¿¡æ¯

### ä½œä¸šé…ç½®ï¼ˆt_batch_job_configï¼‰

| å­—æ®µ | å€¼ |
|------|-----|
| job_id | KNDB2020 |
| bean_name | kndb2020Job |
| description | å¹´åº¦æœˆæ”¶å…¥æŠ¥å‘Šæ•°æ®ç›‘è§† |
| cron_expression | 0 30 0 * * ? |
| cron_description | æ¯å¤©å‡Œæ™¨0:30æ‰§è¡Œ |
| batch_enabled | 1 |

### é‚®ä»¶é…ç½®ï¼ˆt_batch_mail_configï¼‰

| å­—æ®µ | å€¼ |
|------|-----|
| job_id | KNDB2020 |
| email_from | liuym7599@gmail.com |
| mail_to_devloper | liu_ym@hotmail.com,jesuskazuyoshi@gmail.com,lym20230403@gmail.com |
| email_to_user | ï¼ˆç©ºï¼‰ |

---

## ğŸ¯ ä¸šåŠ¡åŠŸèƒ½æ¦‚è¦

### éªŒè¯é€»è¾‘

1. **æ­¥éª¤1**: è·å–æŒ‡å®šå¹´åº¦çš„æ•´ä½“éªŒè¯ç»“æœæ±‡æ€»
   - ç»Ÿè®¡æ€»æœˆä»½æ•°ã€æ­£ç¡®æœˆä»½æ•°ã€é”™è¯¯æœˆä»½æ•°

2. **æ­¥éª¤2**: è·å–æœˆåº¦æ±‡æ€»æ˜ç»†
   - æ¯æœˆçš„åº”æ”¶ã€å·²æ”¯ä»˜ã€æœªæ”¯ä»˜è¯¾è´¹

3. **æ­¥éª¤3**: å¦‚å‘ç°é”™è¯¯ï¼Œæ£€æŸ¥é”™è¯¯æ¥æº
   - è´¹ç”¨è¡¨é”™è¯¯ï¼šä¸€ä¸ªlesson_idå¯¹åº”å¤šä¸ªlsn_fee_id
   - æ”¯ä»˜è¡¨é”™è¯¯ï¼šä¸€ä¸ªlsn_fee_idå¯¹åº”å¤šä¸ªlsn_pay_id

4. **æ­¥éª¤4**: å‘é€é‚®ä»¶é€šçŸ¥
   - æ‰€æœ‰æƒ…å†µéƒ½å‘é€é‚®ä»¶ï¼ˆåŒ…æ‹¬æ­£ç¡®å’Œé”™è¯¯ï¼‰
   - å¼€å‘è€…æ”¶åˆ°è¯¦ç»†æŠ¥å‘Š
   - ç”¨æˆ·æ”¶åˆ°ç®€æ´æ‘˜è¦ï¼ˆå¯é€‰ï¼‰

### æ•°æ®ä¾èµ–

- `v_total_lsnfee_with_paid_unpaid_every_month` (è§†å›¾)
- `t_info_lesson_fee` (è¯¾ç¨‹è´¹ç”¨è¡¨)
- `t_info_lesson_pay` (è¯¾ç¨‹æ”¯ä»˜è¡¨)

---

## ğŸ“ˆ ä»£ç ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | æ€»è¡Œæ•°ï¼ˆä¼°ç®—ï¼‰ |
|------|------|---------------|
| Entityç±» | 4 | ~400è¡Œ |
| DAOæ¥å£ | 1 | ~50è¡Œ |
| Mapper XML | 1 | ~110è¡Œ |
| Tasklet | 1 | ~350è¡Œ |
| Config | 1 | ~130è¡Œ |
| SQLè„šæœ¬ | 3 | ~200è¡Œ |
| æ–‡æ¡£ | 4 | ~2000è¡Œ |
| **æ€»è®¡** | **15ä¸ªæ–‡ä»¶** | **~3240è¡Œ** |

---

## âœ… å®Œæˆæ ‡å‡†

### å¼€å‘å®Œæˆ

- [x] Entityç±»åˆ›å»ºå®Œæˆ
- [x] DAOæ¥å£åˆ›å»ºå®Œæˆ
- [x] Mapper XMLåˆ›å»ºå®Œæˆ
- [x] Taskletä¸šåŠ¡é€»è¾‘åˆ›å»ºå®Œæˆ
- [x] Configé…ç½®åˆ›å»ºå®Œæˆ
- [x] SQLè„šæœ¬åˆ›å»ºå®Œæˆ
- [x] æ–‡æ¡£ç¼–å†™å®Œæˆ

### æµ‹è¯•å®Œæˆ

- [x] ç¼–è¯‘æˆåŠŸï¼ˆBUILD SUCCESSï¼‰
- [ ] æ•°æ®åº“é…ç½®å·²æ‰§è¡Œ
- [ ] MANUALæ¨¡å¼æµ‹è¯•é€šè¿‡
- [ ] AUTOæ¨¡å¼æµ‹è¯•é€šè¿‡
- [ ] é‚®ä»¶å‘é€æˆåŠŸ
- [ ] é‚®ä»¶å†…å®¹éªŒè¯æ­£ç¡®

### éƒ¨ç½²å®Œæˆ

- [ ] ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“é…ç½®
- [ ] ç”Ÿäº§ç¯å¢ƒé‚®ç®±é…ç½®
- [ ] WebæœåŠ¡æ¨¡å¼å¯åŠ¨
- [ ] å®šæ—¶ä»»åŠ¡éªŒè¯ï¼ˆå‡Œæ™¨0:30æ‰§è¡Œï¼‰

---

## ğŸ”„ ä¸‹æ¬¡å¼€å‘å‚è€ƒ

å¼€å‘æ–°çš„Batchæ¨¡å—æ—¶ï¼Œè¯·å‚è€ƒï¼š

1. **[å¼€å‘æ‰‹é¡º_æ–°Batchæ¨¡å—æ ‡å‡†æµç¨‹.md](å¼€å‘æ‰‹é¡º_æ–°Batchæ¨¡å—æ ‡å‡†æµç¨‹.md)** - å®Œæ•´å¼€å‘æµç¨‹
2. **KNDB2020æºä»£ç ** - ä»£ç å®ç°å‚è€ƒ
3. **æœ¬æ¸…å•** - å¿«é€Ÿæ£€æŸ¥ç”¨

---

## ğŸ“ è”ç³»ä¿¡æ¯

**å¼€å‘è€…**: Liu
**é‚®ç®±**: liu_ym@hotmail.com, jesuskazuyoshi@gmail.com
**å¼€å‘æ—¥æœŸ**: 2025-12-16

---

**ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: âœ… å¼€å‘å®Œæˆï¼Œå¾…æµ‹è¯•éªŒè¯
