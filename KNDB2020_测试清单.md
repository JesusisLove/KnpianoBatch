# KNDB2020 æµ‹è¯•æ¸…å•

## âœ… ç¼–è¯‘çŠ¶æ€
- [x] **ç¼–è¯‘æˆåŠŸ** - BUILD SUCCESS (2025-12-16 19:07:15)
- [x] JARæ–‡ä»¶å·²ç”Ÿæˆï¼š`target/knbatch-1.0.0.jar`

---

## ğŸ“ æµ‹è¯•å‰å‡†å¤‡

### 1ï¸âƒ£ ä¿®æ”¹é‚®ç®±é…ç½®
æ‰“å¼€æ–‡ä»¶ï¼š`database/KNDB2020_config_execute.sql`

ä¿®æ”¹è¿™3è¡Œï¼š
```sql
'è¯·ä¿®æ”¹ä¸ºå®é™…çš„å‘é€æ–¹é‚®ç®±',     -- âš ï¸ ä¿®æ”¹è¿™é‡Œ
'è¯·ä¿®æ”¹ä¸ºå®é™…çš„å¼€å‘è€…é‚®ç®±',     -- âš ï¸ ä¿®æ”¹è¿™é‡Œ
```

ä¾‹å¦‚ï¼š
```sql
'noreply@yourdomain.com',
'kazuyoshi@yourdomain.com',
```

### 2ï¸âƒ£ æ‰§è¡Œæ•°æ®åº“é…ç½®
```bash
# æ–¹æ³•1: ä½¿ç”¨mysqlå‘½ä»¤è¡Œ
mysql -u your_username -p your_database < database/KNDB2020_config_execute.sql

# æ–¹æ³•2: ä½¿ç”¨æ•°æ®åº“å®¢æˆ·ç«¯
# æ‰“å¼€ database/KNDB2020_config_execute.sql æ–‡ä»¶
# å¤åˆ¶SQLå†…å®¹åˆ°å®¢æˆ·ç«¯æ‰§è¡Œ
```

### 3ï¸âƒ£ éªŒè¯é…ç½®å·²æ’å…¥
åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œï¼š
```sql
-- æŸ¥çœ‹ä½œä¸šé…ç½®
SELECT * FROM t_batch_job_config WHERE job_id = 'KNDB2020';

-- æŸ¥çœ‹é‚®ä»¶é…ç½®
SELECT * FROM t_batch_mail_config WHERE job_id = 'KNDB2020';
```

åº”è¯¥çœ‹åˆ°ï¼š
- âœ… t_batch_job_config æœ‰1æ¡è®°å½•
- âœ… t_batch_mail_config æœ‰1æ¡è®°å½•
- âœ… é‚®ç®±åœ°å€å·²æ˜¯å®é™…é‚®ç®±ï¼ˆä¸æ˜¯"è¯·ä¿®æ”¹..."ï¼‰

---

## ğŸ§ª æ‰‹åŠ¨æµ‹è¯•

### æµ‹è¯•1: MANUALæ¨¡å¼ï¼ˆæŒ‡å®šæ—¥æœŸï¼‰

```bash
cd /Users/kazuyoshi/Documents/KnPianoBatchRepository/KnpianoBatch

java -jar target/knbatch-1.0.0.jar \
  --job.name=KNDB2020_MANUAL \
  --base.date=20251216
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… ç¨‹åºæ­£å¸¸å¯åŠ¨å¹¶æ‰§è¡Œ
- âœ… æ§åˆ¶å°è¾“å‡ºåŒ…å« "KNDB2020 æ‰¹å¤„ç†å¼€å§‹æ‰§è¡Œ"
- âœ… æ‰§è¡Œå®Œæˆåæ˜¾ç¤º "BUILD SUCCESS" æˆ– "COMPLETED"
- âœ… ç¨‹åºè‡ªåŠ¨é€€å‡º

**æ£€æŸ¥æ—¥å¿—**ï¼š
```bash
# æŸ¥çœ‹ä¸»æ—¥å¿—
tail -100 logs/knpiano-batch.log | grep KNDB2020

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼ˆå¦‚æœæœ‰ï¼‰
tail -100 logs/knpiano-batch-error.log | grep KNDB2020
```

**æ£€æŸ¥é‚®ä»¶**ï¼š
- âœ… å¼€å‘è€…é‚®ç®±æ”¶åˆ°é‚®ä»¶
- âœ… é‚®ä»¶ä¸»é¢˜åŒ…å« "KNDB2020"
- âœ… é‚®ä»¶å†…å®¹åŒ…å«éªŒè¯ç»“æœæ±‡æ€»
- âœ… é‚®ä»¶å†…å®¹åŒ…å«æœˆåº¦æ˜ç»†ï¼ˆå¦‚æœ‰é”™è¯¯ï¼‰

### æµ‹è¯•2: AUTOæ¨¡å¼ï¼ˆå½“å‰æ—¥æœŸï¼‰

```bash
java -jar target/knbatch-1.0.0.jar \
  --job.name=KNDB2020_AUTO
```

**é¢„æœŸç»“æœ**ï¼š
- âœ… è‡ªåŠ¨ä½¿ç”¨ä»Šå¤©çš„æ—¥æœŸï¼ˆ2025å¹´ï¼‰
- âœ… å…¶ä»–ç»“æœåŒæµ‹è¯•1

---

## ğŸ“Š æ—¥å¿—æ£€æŸ¥ç‚¹

åœ¨æ—¥å¿—ä¸­åº”è¯¥çœ‹åˆ°ï¼š

### å¯åŠ¨æ—¥å¿—
```
*************************************************
KNDB2020 å¹´åº¦æœˆæ”¶å…¥æŠ¥å‘Šæ•°æ®ç›‘è§†ä½œä¸šå¼€å§‹æ‰§è¡Œ
ä½œä¸šåç§°: KNDB2020_MANUAL (æˆ– KNDB2020_AUTO)
æ‰§è¡Œæ¨¡å¼: MANUAL (æˆ– AUTO)
åŸºå‡†æ—¥æœŸ: 20251216
ä¸šåŠ¡æè¿°: éªŒè¯å¹´åº¦æœˆæ”¶å…¥æŠ¥å‘Šæ•°æ®çš„å‡†ç¡®æ€§ï¼Œç¡®ä¿åº”æ”¶ = å·²æ”¯ä»˜ + æœªæ”¯ä»˜
*************************************************
```

### æ‰§è¡Œè¿‡ç¨‹æ—¥å¿—
```
æ­¥éª¤1: å¼€å§‹è·å–å¹´åº¦æ±‡æ€»éªŒè¯ç»“æœ...
æ­¥éª¤1: å®Œæˆ - æ€»æœˆä»½æ•°: X, æ­£ç¡®æœˆä»½æ•°: X, é”™è¯¯æœˆä»½æ•°: X
æ­¥éª¤2: å¼€å§‹è·å–æœˆåº¦æ±‡æ€»æ˜ç»†...
æ­¥éª¤2: å®Œæˆ - è·å–åˆ° X ä¸ªæœˆä»½çš„æ•°æ®
```

### å®Œæˆæ—¥å¿—
```
*************************************************
KNDB2020 å¹´åº¦æœˆæ”¶å…¥æŠ¥å‘Šæ•°æ®ç›‘è§†ä½œä¸šæ‰§è¡Œå®Œæˆ
æ‰§è¡ŒçŠ¶æ€: COMPLETED
âœ… å¹´åº¦æœˆæ”¶å…¥æŠ¥å‘Šæ•°æ®ç›‘è§†å¤„ç†æˆåŠŸ
*************************************************
```

---

## ğŸ“§ é‚®ä»¶å†…å®¹æ£€æŸ¥

### å¼€å‘è€…é‚®ä»¶åº”åŒ…å«ï¼š

1. **éªŒè¯ç»“æœæ±‡æ€»**
   ```
   ã€éªŒè¯ç»“æœæ±‡æ€»ã€‘
     æ€»æœˆä»½æ•°: X
     æ­£ç¡®æœˆä»½æ•°: X
     é”™è¯¯æœˆä»½æ•°: X
     æœ€ç»ˆç»“æœ: âœ“ å…¨éƒ¨æ­£ç¡®ï¼ æˆ– âœ— ä»æœ‰é”™è¯¯æœˆä»½
   ```

2. **æœˆåº¦æ±‡æ€»æ˜ç»†**ï¼ˆå¦‚æœ‰é”™è¯¯ï¼‰
   ```
   ã€æœˆåº¦æ±‡æ€»æ˜ç»†ã€‘
   æœˆä»½       åº”æ”¶            å·²æ”¯ä»˜          æœªæ”¯ä»˜     éªŒè¯
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   2025-01   XXXX.XX        XXXX.XX        XXXX.XX    âœ“
   ```

3. **é”™è¯¯è®°å½•è¯¦æƒ…**ï¼ˆå¦‚æœ‰ï¼‰
   ```
   ã€è´¹ç”¨è¡¨é”™è¯¯è®°å½•ã€‘
   ã€æ”¯ä»˜è¡¨é”™è¯¯è®°å½•ã€‘
   ```

4. **è¯¦ç»†æ‰§è¡Œæ—¥å¿—**

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æ‰¾ä¸åˆ°è§†å›¾
**é”™è¯¯ä¿¡æ¯**: Table 'xxx.v_total_lsnfee_with_paid_unpaid_every_month' doesn't exist

**æ£€æŸ¥**:
```sql
SHOW FULL TABLES WHERE Table_type = 'VIEW';
SELECT * FROM v_total_lsnfee_with_paid_unpaid_every_month LIMIT 1;
```

**è§£å†³**: ç¡®ä¿è§†å›¾å­˜åœ¨ä¸”æœ‰æ­£ç¡®çš„æƒé™

### é—®é¢˜2: é‚®ä»¶æœªå‘é€
**æ£€æŸ¥ç¯å¢ƒå˜é‡**:
```bash
echo $SPRING_MAIL_HOST
echo $SPRING_MAIL_PORT
echo $EMAIL_USERNAME
echo $EMAIL_PASSWORD
```

**æ£€æŸ¥é…ç½®**:
```sql
SELECT * FROM t_batch_mail_config WHERE job_id = 'KNDB2020';
```

### é—®é¢˜3: æ•°æ®ä¸ºç©º
**æ£€æŸ¥æ•°æ®**:
```sql
-- æ£€æŸ¥è§†å›¾æ˜¯å¦æœ‰2025å¹´çš„æ•°æ®
SELECT lsn_month, COUNT(*)
FROM v_total_lsnfee_with_paid_unpaid_every_month
WHERE lsn_month LIKE '2025-%'
GROUP BY lsn_month;
```

---

## ğŸ¯ æµ‹è¯•æˆåŠŸæ ‡å‡†

- [  ] ç¼–è¯‘æ— é”™è¯¯
- [  ] æ•°æ®åº“é…ç½®å·²æ’å…¥
- [  ] MANUALæ¨¡å¼æ‰§è¡ŒæˆåŠŸ
- [  ] AUTOæ¨¡å¼æ‰§è¡ŒæˆåŠŸ
- [  ] æ—¥å¿—æ–‡ä»¶æ­£å¸¸ç”Ÿæˆ
- [  ] é‚®ä»¶æ­£å¸¸å‘é€
- [  ] é‚®ä»¶å†…å®¹æ ¼å¼æ­£ç¡®
- [  ] æ•°æ®éªŒè¯é€»è¾‘æ­£ç¡®

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. é”™è¯¯æ—¥å¿—å†…å®¹
2. æ•°æ®åº“é…ç½®æŸ¥è¯¢ç»“æœ
3. æ‰§è¡Œå‘½ä»¤å’Œè¾“å‡º

æˆ‘ä¼šå¸®æ‚¨è§£å†³ï¼

---

**å½“å‰çŠ¶æ€**: âœ… ä»£ç å·²ç¼–è¯‘ï¼Œç­‰å¾…æ•°æ®åº“é…ç½®å’Œæµ‹è¯•
**ä¸‹ä¸€æ­¥**: ä¿®æ”¹é‚®ç®±é…ç½® â†’ æ‰§è¡Œæ•°æ®åº“è„šæœ¬ â†’ è¿è¡Œæµ‹è¯•1
